(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/exp-mipt-fbc-1",headers:{authorization:"1b58de5c-ca46-4253-9f66-d5611b2a5c87","Content-Type":"application/json"}},t=document.querySelector(".profile__edit-button"),n=document.querySelector(".profile__add-button"),r=document.querySelector(".profile__avatar-overlay"),o=document.querySelector(".profile__avatar"),c=document.querySelector(".profile__name"),a=document.querySelector(".profile__description"),u=document.querySelector('.popup[type="picture"]'),i=u.querySelector(".popup__picture"),s=document.querySelectorAll(".popup__close-button"),l=document.querySelectorAll(".popup"),d=document.querySelector('.popup[type="profile"]'),p=document.querySelector('.popup[type="card"]'),f=document.querySelector('.popup[type="avatar'),m={_id:""};function _(e){var t=document.querySelector(".popup_opened");"Escape"===e.key&&h(t)}function v(e){e.classList.add("popup_opened"),document.addEventListener("keydown",_)}function h(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",_)}function y(e,t){c.innerText=e,a.innerText=t}function S(e){o.src=e}var b=document.querySelector(".card-template").content,q=document.querySelector(".elements");function g(t){var n=b.cloneNode(!0);(function(t,n){var r=t.querySelector(".card__picture");r.src=n.link,r.alt=n.name,r.addEventListener("click",(function(){v(u),i.src=r.src,i.alt=r.alt,u.querySelector(".popup__picture-description").textContent=n.name})),t.querySelector(".card__heading").textContent=n.name;var o=t.querySelector(".card__like-counter");o.textContent=n.likes.length;var c=t.querySelector(".card__button");(n.likes.some((function(e){return e._id==m._id}))||""==m._id)&&c.classList.add("card__button_liked"),c.addEventListener("click",(function(t){!function(t,n,r){n.target.classList.toggle("card__button_liked"),function(t,n){return fetch(e.baseUrl+"/cards/likes/".concat(t),{method:n?"DELETE":"PUT",headers:e.headers})}(t,!n.target.classList.contains("card__button_liked")).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){r.textContent=e.likes.length})).catch((function(e){console.log("Ошибка: ".concat(e)),n.target.classList.toggle("card__button_liked")}))}(n._id,t,o)}));var a=t.querySelector(".card__delete-button");m._id==n.owner._id?a.addEventListener("click",(function(t){!function(t,n){(function(t){return fetch(e.baseUrl+"/cards/".concat(t),{method:"DELETE",headers:e.headers})})(t).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){n.target.closest(".card").remove()})).catch((function(e){console.log("Ошибка: ".concat(e))}))}(n._id,t)})):a.classList.add("card__delete-button_disabled")})(n,t),q.prepend(n)}function k(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled=!0,t.classList.add(n))}function E(e,t,n,r){var o=e.querySelector(t);k(Array.from(e.querySelectorAll(n)),o,r)}var L,T=".popup__form",x=".popup__form-field",C=".popup__form-submit",j="popup__form-submit_disabled";fetch(e.baseUrl+"/users/me",{method:"GET",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){m._id=e._id,S(e.avatar),y(e.name,e.about)})).catch((function(e){console.log("Ошибка: ".concat(e))})),fetch(e.baseUrl+"/cards",{method:"GET",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){e.reverse().forEach(g)})).catch((function(e){console.log("Ошибка: ".concat(e))})),s.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return h(t)}))})),l.forEach((function(e){e.addEventListener("click",(function(t){t.target===e&&h(e)}))})),n.addEventListener("click",(function(){v(p),E(p.querySelector(T),C,x,j)})),t.addEventListener("click",(function(){v(d);var e=d.querySelector(T);e.name.value=c.innerText,e.description.value=a.innerText,E(e,C,x,j)})),r.addEventListener("click",(function(){v(f);var e=f.querySelector(T);e.link.value=o.src,E(e,C,x,j)})),d.querySelector(".popup__form").addEventListener("submit",(function(t){t.preventDefault(),function(t){var n,r,o=t.target.name.value,c=t.target.description.value,a=t.target.querySelector(".button");a.innerText="Обновляем...",(n=o,r=c,fetch(e.baseUrl+"/users/me",{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:r})})).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){a.innerText="Сохранить",y(o,c),h(t.target.closest(".popup"))})).catch((function(e){a.innerText="Произошла ошибка",setTimeout((function(){a.innerText="Сохранить"}),1e3),console.log("Ошибка: ".concat(e))}))}(t)})),p.querySelector(".popup__form").addEventListener("submit",(function(t){t.preventDefault(),function(t){var n={name:t.target.name.value,link:t.target.link.value},r=t.target.querySelector(".button");r.innerText="Создаём...",function(t){return fetch(e.baseUrl+"/cards",{method:"POST",headers:e.headers,body:JSON.stringify({name:t.name,link:t.link})})}(n).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){r.innerText="Создать",g(e),h(t.target.closest(".popup")),t.target.name.value="",t.target.link.value=""})).catch((function(e){r.innerText="Произошла ошибка",setTimeout((function(){r.innerText="Создать"}),1e3),console.log("Ошибка: ".concat(e))}))}(t)})),f.querySelector(".popup__form").addEventListener("submit",(function(t){t.preventDefault(),function(t){var n,r=t.target.querySelector(".button");r.innerText="Сохраняем...",(n=t.target.link.value,fetch(e.baseUrl+"/users/me/avatar",{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})})).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){r.innerText="Сохранить",S(e.avatar),h(t.target.closest(".popup"))})).catch((function(e){r.innerText="Произошла ошибка",setTimeout((function(){r.innerText="Сохранить"}),1e3),console.log("Ошибка: ".concat(e))}))}(t)})),L={formSelector:T,inputSelector:x,submitButtonSelector:C,inactiveButtonClass:j,inputErrorClass:"popup__input_error",errorClass:"popup__error_active"},Array.from(document.querySelectorAll(L.formSelector)).forEach((function(e){var t=Array.from(e.querySelectorAll(L.inputSelector)),n=e.querySelector(L.submitButtonSelector);k(t,n,L.inactiveButtonClass),t.forEach((function(r){r.addEventListener("input",(function(o){k(t,n,L.inactiveButtonClass),function(e,t,n,r){t.validity.valid?function(e,t,n,r){var o=e.querySelector(".".concat(t.name,"-input-error"));t.classList.remove(n),o.classList.remove(r),o.textContent=""}(e,t,n,r):function(e,t,n,r,o){var c=e.querySelector(".".concat(t.name,"-input-error"));t.classList.add(r),c.textContent=n,c.classList.add(o)}(e,t,t.validationMessage,n,r)}(e,r,L.inputErrorClass,L.errorClass)}))}))}))})();