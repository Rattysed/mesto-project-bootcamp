(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/exp-mipt-fbc-1",headers:{authorization:"1b58de5c-ca46-4253-9f66-d5611b2a5c87","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject(e.status)}function n(e,n){return fetch(e,n).then(t)}var r=document.querySelector(".profile__edit-button"),o=document.querySelector(".profile__add-button"),c=document.querySelector(".profile__avatar-overlay"),a=document.querySelector(".profile__avatar"),i=document.querySelector(".profile__name"),u=document.querySelector(".profile__description"),s=document.querySelector('.popup[type="picture"]'),l=s.querySelector(".popup__picture"),d=document.querySelectorAll(".popup__close-button"),p=document.querySelectorAll(".popup"),f=document.querySelector('.popup[type="profile"]'),m=document.querySelector('.popup[type="card"]'),_=document.querySelector('.popup[type="avatar'),v={_id:""},y=document.querySelector(".card-template").content,h=document.querySelector(".elements");function S(t){var r=y.cloneNode(!0);(function(t,r){var o=t.querySelector(".card__picture");o.src=r.link,o.alt=r.name,o.addEventListener("click",(function(){q(s),l.src=o.src,l.alt=o.alt,s.querySelector(".popup__picture-description").textContent=r.name})),t.querySelector(".card__heading").textContent=r.name;var c=t.querySelector(".card__like-counter");c.textContent=r.likes.length;var a=t.querySelector(".card__button");(r.likes.some((function(e){return e._id==v._id}))||""==v._id)&&a.classList.add("card__button_liked"),a.addEventListener("click",(function(t){!function(t,r,o){(function(t,r){return n(e.baseUrl+"/cards/likes/".concat(t),{method:r?"DELETE":"PUT",headers:e.headers})})(t,r.target.classList.contains("card__button_liked")).then((function(e){r.target.classList.toggle("card__button_liked"),o.textContent=e.likes.length})).catch((function(e){console.log("Ошибка: ".concat(e))}))}(r._id,t,c)}));var i=t.querySelector(".card__delete-button");v._id==r.owner._id?i.addEventListener("click",(function(t){!function(t,r){(function(t){return n(e.baseUrl+"/cards/".concat(t),{method:"DELETE",headers:e.headers})})(t).then((function(e){r.target.closest(".card").remove()})).catch((function(e){console.log("Ошибка: ".concat(e))}))}(r._id,t)})):i.classList.add("card__delete-button_disabled")})(r,t),h.prepend(r)}function b(e){"Escape"===e.key&&E(document.querySelector(".popup_opened"))}function q(e){e.classList.add("popup_opened"),document.addEventListener("keydown",b)}function E(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",b)}function g(e,t){i.innerText=e,u.innerText=t}function k(e){a.src=e}function L(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled=!0,t.classList.add(n))}function T(e,t,n,r){var o=e.querySelector(t);L(Array.from(e.querySelectorAll(n)),o,r)}var x,C=".popup__form",A=".popup__form-field",U=".popup__form-submit",P="popup__form-submit_disabled";Promise.all([n(e.baseUrl+"/users/me",{method:"GET",headers:e.headers}),n(e.baseUrl+"/cards",{method:"GET",headers:e.headers})]).then((function(e){var t;t=e[0],v._id=t._id,k(t.avatar),g(t.name,t.about),e[1].reverse().forEach(S)})),d.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return E(t)}))})),p.forEach((function(e){e.addEventListener("click",(function(t){t.target===e&&E(e)}))})),o.addEventListener("click",(function(){q(m),T(m.querySelector(C),U,A,P)})),r.addEventListener("click",(function(){q(f);var e=f.querySelector(C);e.name.value=i.innerText,e.description.value=u.innerText,T(e,U,A,P)})),c.addEventListener("click",(function(){q(_);var e=_.querySelector(C);e.link.value=a.src,T(e,U,A,P)})),f.querySelector(".popup__form").addEventListener("submit",(function(t){t.preventDefault(),function(t){var r,o,c=t.target.name.value,a=t.target.description.value,i=t.submitter;i.innerText="Обновляем...",(r=c,o=a,n(e.baseUrl+"/users/me",{method:"PATCH",headers:e.headers,body:JSON.stringify({name:r,about:o})})).then((function(e){i.innerText="Сохранить",g(c,a),E(t.target.closest(".popup"))})).catch((function(e){i.innerText="Произошла ошибка",setTimeout((function(){i.innerText="Сохранить"}),1e3),console.log("Ошибка: ".concat(e))}))}(t)})),m.querySelector(".popup__form").addEventListener("submit",(function(t){t.preventDefault(),function(t){var r={name:t.target.name.value,link:t.target.link.value},o=t.submitter;o.innerText="Создаём...",function(t){return n(e.baseUrl+"/cards",{method:"POST",headers:e.headers,body:JSON.stringify({name:t.name,link:t.link})})}(r).then((function(e){o.innerText="Создать",S(e),E(t.target.closest(".popup")),t.target.name.value="",t.target.link.value=""})).catch((function(e){o.innerText="Произошла ошибка",setTimeout((function(){o.innerText="Создать"}),1e3),console.log("Ошибка: ".concat(e))}))}(t)})),_.querySelector(".popup__form").addEventListener("submit",(function(t){t.preventDefault(),function(t){var r,o=t.submitter;o.innerText="Сохраняем...",(r=t.target.link.value,n(e.baseUrl+"/users/me/avatar",{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:r})})).then((function(e){o.innerText="Сохранить",k(e.avatar),E(t.target.closest(".popup"))})).catch((function(e){o.innerText="Произошла ошибка",setTimeout((function(){o.innerText="Сохранить"}),1e3),console.log("Ошибка: ".concat(e))}))}(t)})),x={formSelector:C,inputSelector:A,submitButtonSelector:U,inactiveButtonClass:P,inputErrorClass:"popup__input_error",errorClass:"popup__error_active"},Array.from(document.querySelectorAll(x.formSelector)).forEach((function(e){var t=Array.from(e.querySelectorAll(x.inputSelector)),n=e.querySelector(x.submitButtonSelector);L(t,n,x.inactiveButtonClass),t.forEach((function(r){r.addEventListener("input",(function(o){L(t,n,x.inactiveButtonClass),function(e,t,n,r){t.validity.valid?function(e,t,n,r){var o=e.querySelector(".".concat(t.name,"-input-error"));t.classList.remove(n),o.classList.remove(r),o.textContent=""}(e,t,n,r):function(e,t,n,r,o){var c=e.querySelector(".".concat(t.name,"-input-error"));t.classList.add(r),c.textContent=n,c.classList.add(o)}(e,t,t.validationMessage,n,r)}(e,r,x.inputErrorClass,x.errorClass)}))}))}))})();